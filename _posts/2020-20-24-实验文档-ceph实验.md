---
layout:     post
title:      äº‘å­˜å‚¨æŠ€æœ¯è€ƒè¯•å‚é˜…æ–‡æ¡£
subtitle:    "\"cephå®éªŒæ–‡æ¡£\""
date:       2020-12-24
author:     Philcher
header-img: img/post-bg-2015.jpg
catalog: true
tags:
    - æ–‡æ¡£



---

> â€œğŸ™‰ğŸ™‰ğŸ™‰ â€

**Ceph**

1ã€å…ˆä¿®æ”¹ä¸‰å°ä¸»æœºçš„ä¸»æœºå

vi /etc/hostname ä¸‰ä¸ªéƒ½è¦æ”¹ï¼Œä¿®æ”¹å®Œæˆæ‰§è¡Œrebooté‡å¯åéªŒè¯ä¸»æœºåæ˜¯å¦ä¿®æ”¹æˆåŠŸ

2ã€ä¿®æ”¹ç½‘å¡é…ç½®ï¼ŒONBOOT=yesï¼Œå¹¶é‡å¯ç½‘ç»œæœåŠ¡ï¼Œå…‹éš†

3ã€æŒ‰ç…§ä¹¦ä¸Šçš„è¦æ±‚ï¼Œä¿®æ”¹ç¬¬ä¸€å°ä¸»æœºçš„/etc/hostsæ–‡ä»¶ï¼Œæ³¨æ„ä¸»æœºåå’ŒIPçš„å¯¹åº”å…³ç³»

4ã€è¿œç¨‹å¤åˆ¶ä¸»æœº1çš„hostsæ–‡ä»¶åˆ°ä¸»æœº2å’Œ3

scp -r /etc/hosts [root@192.168.220.129:/etc](mailto:root@192.168.220.129:/etc)

scp -r /etc/hosts [root@192.168.220.130:/etc](mailto:root@192.168.220.130:/etc)

5ã€ä¸»æœº1æ“ä½œï¼Œè¾“å…¥ssh-keygenï¼Œç„¶åä¸€ç›´å›è½¦ï¼Œç›´åˆ°ç¨‹åºç»“æŸ

æ‰§è¡Œ**l.**ï¼ˆå°å†™çš„Lï¼‰ã€cd .sshã€ls ä¸‰æ¡å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰id_rsa.pubæ–‡ä»¶

å°†æœ¬æœºçš„å…¬é’¥è¿½åˆ°ç›®æ ‡ä¸»æœº2å’Œ3é‡Œ

ssh-copy-id -i ~/.ssh/id_rsa.pub root@ceph-node2

ssh-copy-id -i ~/.ssh/id_rsa.pub root@ceph-node3

æ³¨æ„ï¼šæ‰§è¡Œä¸­éœ€è¦è¾“å…¥2å’Œ3çš„ç™»é™†å¯†ç ï¼ˆ000000ï¼‰

6ã€éªŒè¯å…å¯†ç™»é™†æ˜¯å¦æˆåŠŸï¼Œç¬¬ä¸€å°ä¸»æœºä¸Šæ‰§è¡Œï¼š

ssh root@ceph-node2  çœ‹æ˜¯å¦èƒ½å¤Ÿç›´æ¥ç™»é™†åˆ°ç¬¬äºŒå°ä¸»æœºï¼ˆçœ‹å‘½ä»¤è¡Œé¦–ç«¯çš„ä¸»æœºåå³å¯ï¼‰ï¼›ssh root@ceph-node3

7ã€service firewalld stop å…³é—­é˜²ç«å¢™ï¼ˆä¸‰å°éƒ½è¦æ‰§è¡Œï¼‰

8ã€setenforce0 ã€vi /etc/selinux/config æŠŠselinuxæ”¹ä¸ºdisabledï¼ˆä¸‰å°éƒ½è¦æ‰§è¡Œï¼‰

9ã€å®‰è£…ntpï¼ŒæŒ‰ç…§ä¹¦æœ¬å†…å®¹ï¼ˆä¸‰å°éƒ½è¦æ‰§è¡Œï¼‰

yum install â€“y ntp ntpdate

ntpdate pool.ntp.org

chkconfig ntpd on

10ã€   

vi /etc/yum.repos.d/local.repoï¼ˆç¬¬ä¸€å°æ‰§è¡Œï¼‰

[centos7.2]

name=centos7.2

baseurl=file:///opt/centos7.2

gpgcheck=0

enabled=1

[iaas]

name=iaas

baseurl=file:///opt/iaas-repo

gpgcheck=0

enabled=1

å°†ç¬¬ä¸€å°ä¸»æœºä¸­çš„local.repoæ–‡ä»¶è¿œç¨‹ä¼ è¾“è‡³ä¸»æœº2å’Œ3

scp -r /etc/yum.repos.d/local.repo [root@ceph-node2:/etc/yum.repos.d/](mailto:root@ceph-node2:/etc/yum.repos.d/)

scp -r /etc/yum.repos.d/local.repo root@ceph-node3:/etc/yum.repos.d/

11ã€   winscpä¸Šä¼ CentOS-7-x86_64-DVD-1804.isoå’ŒXianDian-IaaS-v2.0-20170420.isoé•œåƒåˆ°ä¸»æœº1å¹¶è§£å‹è‡³æŒ‡å®šç›®å½•ï¼Œå‚è€ƒä¹¦æœ¬118é¡µçš„æ–¹æ³•

12ã€   ä¸»æœº1 å°†centos7.2ã€iaas-repoã€imagesä¸‰ä¸ªæ–‡ä»¶å¤¹é€šè¿‡è¿œç¨‹å¤åˆ¶åˆ°ä¸»æœº2å’Œ3

scp -r /opt/centos7.2 root@ceph-node2:/opt

scp -r /opt/centos7.2 root@ceph-node3:/opt

  scp -r /opt/iaas-repo root@ceph-node2:/opt

  scp -r /opt/iaas-repo root@ceph-node3:/opt

13ã€   ä¸»æœº1ã€2ã€3ï¼Œå…¨éƒ¨å®‰è£…createrepo å¹¶é‡æ–°ç”Ÿæˆrepo.xmlæ–‡ä»¶ï¼ˆæ³¨ï¼šå¦‚æ­¤æ­¥ä¸æ“ä½œï¼Œé‚£æ‰§è¡Œyum listæ—¶ä¼šå¼‚å¸¸æŠ¥é”™ï¼‰

yum install createrepo -y

cd /opt

createrepo centos7.2/

â€‹    createrepo iaas-repo/

14ã€   ä¸»æœº1ã€2å’Œ3ï¼Œå…¨éƒ¨æ‰§è¡Œyum clean allã€yum listï¼Œåº”èƒ½æ‰§è¡ŒæˆåŠŸ

15ã€   ä¸»æœº1ã€2/å’Œ3è¿›è¡Œcephå®‰è£…å‰çš„åŸºç¡€åŒ…å®‰è£…

**cd /opt/iaas-repo/base**,å®‰è£…å¦‚ä¸‹ä¸‰ä¸ªè½¯ä»¶åŒ…(ä¸‰å°éƒ½è¦)

rpm -ivh python-backports-1.0-8.el7.x86_64.rpm

rpm -ivh python-backports-ssl_match_hostname-3.4.0.2-4.el7.noarch.rpm

rpm -ivh python-setuptools-0.9.8-4.el7.noarch.rpm

 

**æ‹å¿«ç…§ï¼ï¼æ‹å¿«ç…§ï¼ï¼æ‹å¿«ç…§ï¼ï¼**

 

16ã€   æŒ‰ç…§ä¹¦æœ¬166é¡µå†…å®¹åœ¨ä¸»æœº1 ceph-node1 å®‰è£…ceph-deploy â€“y

\# yum install ceph-deploy â€“y

\# mkdir /etc/ceph

\# ceph-deploy new ceph-node1

\# ceph-deploy install ceph-node1 ceph-node2 ceph-node3 

\# ceph â€“v

\#ceph-deploy â€“overwrite-conf mon create-initial

\# ceph â€“s

\# cephâ€“deploy disk list ceph-node1

\# mkdir â€“p /opt/osd1

\# chmod 777 /opt/osd1

\# ssh ceph-node2

\# mkdir â€“p /opt/osd2

\# chmod 777 /opt/osd2

\# ssh ceph-node3

\# mkdir â€“p /opt/osd3

\# chmod 777 /opt/osd3

\# ceph-deploy osd prepare ceph-node1:/opt/osd1 ceph-node2:/opt/osd2 ceph-node3:/opt/osd3

\# ceph-deploy osd activate ceph-node1:/opt/osd1 ceph-node2:/opt/osd2 ceph-node3:/opt/osd3

\# ceph â€“s

\# ceph-deploy admin ceph-node{1,2,3}

\# chmod +r /etc/ceph/ceph.client.admin.keyring

\# ceph status

\# ceph â€“w

\# ceph quorum_status â€“format json-pretty

\# ceph mon dump 

\# ceph df 